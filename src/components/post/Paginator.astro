---
import { Button } from '@components/ui/button';
import type { Page } from 'astro';
import { FaChevronLeft, FaChevronRight } from 'react-icons/fa';
import type { BlogPost } from 'types/blog';

interface Props {
  page: Page<BlogPost>;
  baseUrl?: string; // 分页基础路径，默认为 '/posts'
  isHomePage?: boolean; // 是否是首页
}

const { page, baseUrl = '/posts', isHomePage = false } = Astro.props;

// 生成页面链接的辅助函数
const getPageUrl = (pageNum: number) => {
  // 如果是首页模式，第1页指向 '/'，其他页指向 '/posts/x'
  if (isHomePage) {
    return pageNum === 1 ? '/' : `${baseUrl}/${pageNum}`;
  }
  // 普通模式：第1页是 baseUrl，其他页是 baseUrl/2 等
  return pageNum === 1 ? baseUrl : `${baseUrl}/${pageNum}`;
};
---

<div class="flex-center gap-1 font-bold">
  {
    page.url.prev ? (
      <a href={page.url.prev} aria-label="前のページ">
        <Button variant="ghost">
          <FaChevronLeft />
        </Button>
      </a>
    ) : (
      <Button variant="ghost" disabled aria-label="前のページ">
        <FaChevronLeft />
      </Button>
    )
  }

  {
    page.currentPage !== 1 && page.currentPage - 1 !== 1 && (
      <a href={getPageUrl(1)} aria-label="1 ページ目">
        <Button variant="ghost">1</Button>
      </a>
    )
  }
  {page.currentPage > 2 && <span class="mx-1">...</span>}
  {
    page.currentPage !== 1 && (
      <a href={getPageUrl(page.currentPage - 1)} aria-label={`${page.currentPage - 1} ページ目`}>
        <Button variant="ghost">{page.currentPage - 1}</Button>
      </a>
    )
  }

  <Button
    variant="ghost"
    disabled
    aria-current="page"
    aria-label={`${page.currentPage} ページ目（現在のページ）`}
    className="text-primary disabled:opacity-100"
  >
    {page.currentPage}
  </Button>

  {
    page.currentPage !== page.lastPage && (
      <a href={getPageUrl(page.currentPage + 1)} aria-label={`${page.currentPage + 1} ページ目`}>
        <Button variant="ghost">{page.currentPage + 1}</Button>
      </a>
    )
  }
  {page.currentPage < page.lastPage - 2 && <span class="mx-1">...</span>}
  {
    page.currentPage !== page.lastPage && page.currentPage + 1 !== page.lastPage && (
      <a href={getPageUrl(page.lastPage)} aria-label={`${page.lastPage} ページ目`}>
        <Button variant="ghost">{page.lastPage}</Button>
      </a>
    )
  }
  {
    page.url.next ? (
      <a href={page.url.next}>
        <Button variant="ghost">
          <FaChevronRight aria-label="次のページ" />
        </Button>
      </a>
    ) : (
      <Button variant="ghost" disabled aria-label="次のページ">
        <FaChevronRight />
      </Button>
    )
  }
</div>
